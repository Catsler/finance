# KDJ 做T策略规则手册 v1.0

> **启动日期**：2025年12月23日（周一）
> **模拟盘规模**：12只股票 × ~30万/只 ≈ 360万
> **策略类型**：60分钟KDJ超买超卖 + 日线趋势过滤

---

## 一、核心信号规则

### 1.1 买入信号（做多/加仓）

同时满足以下条件：
1. **J值超卖**：`J < 25`
2. **振幅活跃**：`当日振幅 > 2%`
3. **价格低位**：`60m收盘价 < MA20`
4. **日线趋势**：`daily_trend ≠ DOWN`（UP或FLAT允许）

**执行限制**：
- ❌ **15:00 K线不执行**（收盘前无法确认信号）
- ❌ **Kill Switch 开启时禁止**

### 1.2 卖出信号（做空/减仓）

同时满足以下条件：
1. **J值超买**：`J > 75`
2. **振幅活跃**：`当日振幅 > 2%`
3. **价格高位**：`60m收盘价 > MA20`

**执行限制**：
- ❌ **15:00 K线不执行**
- ✅ **日线趋势DOWN时仍可卖出**（不受gate限制）
- ⚠️ **T+1限制**：昨日及以前买入的才可卖

---

## 二、仓位管理规则

### 2.1 初始仓位
- 每只股票 **底仓30万**
- 持仓区间：`底仓的50%-150%`
  - 最小持仓：15万（底仓×50%）
  - 最大持仓：45万（底仓×150%）

### 2.2 做T仓位
- **单次做T金额**：底仓的10%-20%（约3-6万）
  - 保守：10%（~3万）
  - 激进：20%（~6万）
- **单日做T次数上限**：3次/股

### 2.3 仓位计算

```
可买数量 = min(
    (目标金额 / 当前价格) 取整到100股,
    (可用现金 / 当前价格) 取整到100股
)

可卖数量 = min(
    (目标金额 / 当前价格) 取整到100股,
    可卖股数（T+1后的持仓）
)
```

---

## 三、风控规则

### 3.1 止损规则
| 级别 | 条件 | 动作 |
|------|------|------|
| **个股止损** | 单日亏损 > 2% | 当日禁止该股加仓 |
| **组合止损** | 总资产回撤 > 3% | 触发Kill Switch |
| **极端止损** | 总资产回撤 > 5% | 暂停策略人工介入 |

### 3.2 时间限制
- **禁止交易时段**：
  - 09:30前（开盘前）
  - 11:30-13:00（午休）
  - 14:55后（收盘前5分钟）
  - **15:00 K线信号只记录不执行**

### 3.3 日线趋势 Gate
- **DOWN**：禁止新开多仓（可卖出）
- **UP/FLAT**：允许开仓
- 趋势判定：`MA20斜率 + 收盘价vs MA20`

### 3.4 信号冷却
- **同向信号冷却**：60分钟
- **防重复执行**：基于`dedup_key`

---

## 四、执行流程

### 4.1 信号扫描（每60分钟）

```bash
# 手动执行
PYTHONPATH=/Users/elie/Downloads/Stock python scripts/kdj_scan.py \
  --symbols 002812.SZ,300568.SZ,300750.SZ,002594.SZ,601012.SH,600519.SH,000858.SZ,300059.SZ,002475.SZ,300760.SZ,600309.SH,000333.SZ

# 输出
# → results/pending_signals.json（待执行信号）
# → results/phase7_kdj_signals_YYYYMMDD.jsonl（审计日志）
```

### 4.2 信号执行（可选自动化）

```bash
# 手动执行
PYTHONPATH=/Users/elie/Downloads/Stock python scripts/kdj_execute.py

# 或查看pending_signals.json后在Dashboard手动下单
```

### 4.3 人工确认流程
1. 收到信号后，打开 Dashboard
2. 确认：
   - 日线趋势状态
   - 当前持仓比例
   - K线形态是否支持
3. 手动下单或跳过

---

## 五、监控与复盘

### 5.1 实时监控（Dashboard）

| 监控项 | 位置 | 频率 |
|--------|------|------|
| K线+KDJ图表 | 主面板 | 60s刷新 |
| 日线趋势 | 交易面板 | 切换股票时 |
| 持仓/盈亏 | 右侧面板 | 15s刷新 |
| 成交记录 | 成交Tab | 15s刷新 |

### 5.2 每日复盘清单
- [ ] 检查当日信号触发次数
- [ ] 统计做T胜率（赢/输次数）
- [ ] 计算单日净盈亏
- [ ] 记录特殊情况（假信号/错过信号）

### 5.3 周度评估指标
| 指标 | 目标 | 计算方式 |
|------|------|---------|
| 做T胜率 | > 55% | 盈利次数/总次数 |
| 平均盈亏比 | > 1.2 | 平均盈利/平均亏损 |
| 周收益率 | > 0.5% | (周末总资产-周初)/周初 |
| 最大回撤 | < 3% | 峰值到谷底 |

---

## 六、参数配置汇总

```yaml
# 信号参数
kdj:
  j_oversold: 25      # J<25 触发买入
  j_overbought: 75    # J>75 触发卖出
  amp_threshold: 0.02 # 当日振幅>2%
  ma_period: 20       # 60分钟MA周期

# 日线趋势
daily_trend:
  ma_period: 20
  lookback: 5
  eps_down: -0.008    # 斜率<-0.8% 且 close<MA20 → DOWN
  eps_up: 0.005       # 斜率>+0.5% 且 close>MA20 → UP

# 仓位
position:
  base_value: 300000       # 底仓30万
  min_ratio: 0.5           # 最小持仓比例
  max_ratio: 1.5           # 最大持仓比例
  single_trade_ratio: 0.15 # 单次做T比例（15%≈4.5万）

# 风控
risk:
  single_stock_loss: 0.02  # 个股止损2%
  portfolio_drawdown: 0.03 # 组合止损3%
  cooldown_minutes: 60     # 信号冷却60分钟
  daily_trades_warn: 10    # 单日交易警告
  daily_trades_reject: 15  # 单日交易拒绝

# 执行
execution:
  order_type: AGGRESSIVE   # 对手价成交
  skip_1500_bar: true      # 跳过15:00信号
```

---

## 七、周一启动 Checklist

### 7.1 启动前确认
- [ ] 后端服务器运行正常 (`scripts/paper_trading_server.py`)
- [ ] 前端Dashboard可访问 (http://localhost:3000)
- [ ] 12只股票全部T+1解锁可卖
- [ ] 检查各股票日线趋势状态

### 7.2 交易时段操作
| 时间 | 操作 |
|------|------|
| 09:25 | 启动服务器，打开Dashboard |
| 09:30 | 观察开盘情况，不急于操作 |
| 10:30 | 第一根60mK线完成，首次扫描信号 |
| 11:30 | 午休，暂停交易 |
| 13:00 | 恢复交易 |
| 14:00 | 最后一次主动做T窗口 |
| 14:55 | 停止新开仓，只处理平仓 |
| 15:00 | 收盘，记录当日情况 |

### 7.3 异常处理
| 异常 | 处理方式 |
|------|---------|
| 服务器断开 | 重启服务器，检查持仓一致性 |
| 信号漏执行 | 下一周期重新评估 |
| 成交价偏离大 | 记录滑点，考虑调整order_type |
| 触发止损 | 执行止损后当日暂停该股 |

---

## 八、待优化事项（v1.1+）

1. **WebSocket 推送**：减少轮询延迟
2. **多周期共振**：15m+60m+日线三周期
3. **成交量确认**：放量突破效果更好
4. **自适应参数**：根据波动率动态调整J阈值
5. **自动化执行**：launchd定时任务
