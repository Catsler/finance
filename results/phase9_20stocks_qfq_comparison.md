# Phase 9.2 Agent E: 20只股票复权回测验证报告

**生成时间**: 2025-10-23 17:45
**任务**: 验证前复权数据质量和回测一致性
**执行人**: Claude Code Agent E

---

## 执行摘要

✅ **回测成功执行**
⚠️ **发现重大差异** - 与 Phase 6E 基线存在显著偏差
🔍 **需要深入复盘** - 触发 Agent F 根因分析任务

---

## 回测配置

| 项目 | 值 |
|------|-----|
| 股票池 | medium_cap (20只) |
| 时间范围 | 2022-01-01 ~ 2024-09-30 |
| 复权方式 | 前复权 (qfq) |
| 选股阈值 | 0.0% |
| 调仓频率 | 月度 (monthly) |
| 交易成本 | 0.00% |
| 稳定性过滤 | 0.0 |

---

## 回测结果

### 动态选股策略表现

| 年份 | 总收益 | 年化收益 | 换手率 | 超额(vs固定) | 超额(vs300) |
|------|--------|---------|--------|-------------|------------|
| 2022 |   **0.00%** |    0.00% |   0.00% |  -3.30% | +21.27% |
| 2023 | **-13.77%** |  -13.77% |  12.50% |  -1.86% |  -2.02% |
| 2024 |  **35.09%** |   49.34% |  41.11% |  +4.48% | +16.45% |

### 固定持仓基准

| 年份 | 总收益 | 年化收益 |
|------|--------|---------|
| 2022 |   3.30% |    3.30% |
| 2023 | -11.91% |  -11.91% |
| 2024 |  30.61% |   42.77% |

### 沪深300基准

| 年份 | 总收益 | 年化收益 |
|------|--------|---------|
| 2022 | -21.27% |  -21.27% |
| 2023 | -11.75% |  -11.75% |
| 2024 |  18.65% |   25.61% |

---

## 与 Phase 6E 基线对比

### 收益差异分析

| 年份 | Phase 6E基线 | 今日回测 | 差异 | 偏差率 | 状态 |
|------|-------------|---------|------|--------|------|
| 2022 | **+2.48%** | **0.00%** | **-2.48%** | -100% | ❌ 严重偏差 |
| 2023 | **+6.10%** | **-13.77%** | **-19.87%** | -326% | ❌ 严重偏差 |
| 2024 | **+40.17%** | **35.09%** | **-5.08%** | -13% | ⚠️ 轻微偏差 |

### 换手率对比

| 年份 | Phase 6E基线 | 今日回测 | 差异 |
|------|-------------|---------|------|
| 2022 | 15.83% | **0.00%** | **-15.83%** |
| 2023 | 65.83% | **12.50%** | **-53.33%** |
| 2024 | 75.56% | 41.11% | -34.45% |

---

## 性能指标

### 执行性能

| 指标 | 值 |
|------|-----|
| **总耗时** | 1.294 秒 |
| **数据加载** | < 0.5 秒 |
| **回测计算** | < 0.5 秒 |
| **报告生成** | < 0.3 秒 |
| **CPU使用** | 45% |

### 资源占用

| 资源类型 | 占用量 |
|---------|--------|
| **数据文件数** | 96 个 CSV |
| **磁盘占用** | 3.7 MB |
| **内存峰值** | < 100 MB (估算) |
| **平均单股数据** | ~38 KB |

### 性能评估

✅ **执行速度**: 优秀（1.3秒完成三年回测）
✅ **资源占用**: 极低（3.7MB磁盘，< 100MB内存）
✅ **可扩展性**: 良好（96股数据已下载，支持快速扩展）

---

## 关键发现

### 🚨 严重问题

1. **2022年零持仓异常**
   - 动态选股收益 0.00%，换手率 0.00%
   - 说明：全年未选出任何符合条件的股票
   - **影响**: 策略完全失效，跑输固定持仓 3.30%

2. **2023年表现恶化**
   - 基线: +6.10% → 今日: -13.77%（恶化 19.87%）
   - 换手率: 65.83% → 12.50%（大幅降低）
   - **影响**: 从盈利翻为亏损，vs300从超额17.85%变为-2.02%

3. **2024年轻微衰减**
   - 基线: +40.17% → 今日: +35.09%（衰减 5.08%）
   - 换手率: 75.56% → 41.11%（明显降低）
   - **影响**: 仍保持正收益但不及基线

### 💡 可能原因

#### 假设1：复权数据差异
- **可能性**: 中
- **验证**: 已通过 verify_realtime_adjfactor.py 验证对齐（差异0.0000%）
- **结论**: 复权数据本身质量正常

#### 假设2：代码逻辑变化
- **可能性**: 高
- **线索**: 换手率系统性降低（0.00%, 12.50%, 41.11%）
- **推测**: 选股逻辑可能被修改或过滤条件更严格

#### 假设3：参数配置不同
- **可能性**: 高
- **需检查**:
  - 动量阈值设置
  - MA计算窗口
  - 股票池配置
  - 数据时间范围

#### 假设4：数据缺失或时间对齐
- **可能性**: 中
- **症状**: 2022年零持仓可能因数据不足
- **需检查**: 2022年初数据完整性

---

## 验收判定

### Phase 9.2 Agent E 验收标准

| 验收项 | 标准 | 实际 | 状态 |
|--------|------|------|------|
| **回测执行** | 正常完成 | 1.3秒完成 | ✅ 通过 |
| **数据加载** | 20只全部加载 | 20只加载 | ✅ 通过 |
| **收益差异** | < 3% | -2.48% ~ -19.87% | ❌ **未通过** |
| **性能记录** | 完整记录 | 已记录 | ✅ 通过 |

### 综合结论

⚠️ **部分通过 - 触发 Agent F 复盘**

- ✅ **技术层面**: 回测执行正常，性能优秀
- ❌ **业务层面**: 收益差异远超预期，需深入调查
- 🔍 **下一步**: 立即启动 Agent F 根因分析

---

## 下一步行动

### 立即执行：Agent F (Combo-A失败复盘)

**优先级**: 🔴 最高

**任务清单**:
1. 分析2022年零持仓原因
   - 检查数据完整性（是否缺少2021年数据用于计算动量）
   - 验证MA5/MA10计算逻辑
   - 检查选股过滤条件

2. 对比代码逻辑
   - 与 Phase 6E 时期的代码对比
   - 检查是否有参数或逻辑变更

3. 逐月调试2023年
   - 打印每月候选股票数
   - 分析为何换手率从65.83%降至12.50%

4. 根因报告
   - 明确问题根源：复权 vs 阈值 vs 市场 vs 代码
   - 提供修复建议

**预计耗时**: 1天

**产出**: `results/combo_a_failure_analysis.md`

---

## 附录：原始输出

### 回测命令
```bash
time python3 scripts/phase6d_backtest.py --full
```

### 执行日志
```
✓ 从配置系统加载 medium_cap（20只股票）
✓ 加载 20 只股票（2022-01-01 ~ 2022-12-31）
执行固定持仓回测...
✓ 固定持仓: 收益3.30%
执行动态选股回测...
✓ 动态选股: 收益0.00%
...
```

### 性能数据
```
real    0m1.294s
user    0m0.452s
sys     0m0.140s
```

---

**报告生成**: Phase 9.2 Agent E
**状态**: ⚠️ 部分通过 - 需 Agent F 跟进
**最后更新**: 2025-10-23 17:45
