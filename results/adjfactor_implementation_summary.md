# adjfactorå®æ–½å®Œæˆæ€»ç»“

## ğŸ“Š æ‰§è¡Œç»“æœ

**æ‰§è¡Œæ—¶é—´**: 2025-10-16
**ä»»åŠ¡**: ä¸ºQlibè‚¡ç¥¨æ•°æ®æ·»åŠ å‰å¤æƒå› å­(adjfactor)åˆ—

### âœ… å®ŒæˆçŠ¶æ€

| æ­¥éª¤ | è„šæœ¬ | çŠ¶æ€ | ç»“æœ |
|------|------|------|------|
| 1 | fetch_dividend_adata.py | âœ… æˆåŠŸ | 397æ¡åˆ†çº¢è®°å½•,20åªè‚¡ç¥¨ |
| 2 | calculate_adjfactor.py | âœ… æˆåŠŸ | 20/20è‚¡ç¥¨è®¡ç®—å®Œæˆ |
| 3 | verify_calculated_adjfactor.py | âœ… æˆåŠŸ | 100%éªŒè¯é€šè¿‡ |
| 4 | add_adjfactor_to_all.py | âœ… æˆåŠŸ | 20/20è‚¡ç¥¨æ›´æ–°å®Œæˆ |

## ğŸ”§ å…³é”®æŠ€æœ¯ä¿®å¤

### 1. AData APIè°ƒç”¨é—®é¢˜
**é—®é¢˜**: æ‰€æœ‰è‚¡ç¥¨è¿”å›"æ— åˆ†çº¢æ•°æ®"
**åŸå› **: AData APIéœ€è¦çº¯æ•°å­—ä»£ç (å¦‚`600519`),ä¸èƒ½å¸¦äº¤æ˜“æ‰€åç¼€(`.SH/.SZ`)
**è§£å†³**: 
```python
stock_code = symbol.split('.')[0]  # 000001.SZ â†’ 000001
df = adata.stock.market.get_dividend(stock_code=stock_code)
```

### 2. dividend_planè§£æ
**é—®é¢˜**: æ‰€æœ‰adjfactorè®¡ç®—ä¸º1.0000(æ— å˜åŒ–)
**åŸå› **: ADataè¿”å›`dividend_plan`å­—ç¬¦ä¸²(å¦‚"10è‚¡æ´¾308.76å…ƒ"),ä»£ç æœŸæœ›åˆ†ç¦»çš„åˆ—
**è§£å†³**: å®ç°parse_dividend_plan()å‡½æ•°
```python
def parse_dividend_plan(plan_str):
    # "10è‚¡æ´¾308.76å…ƒ" â†’ (30.876, 0, 0)
    # "10è‚¡æ´¾21.03å…ƒé€2è‚¡è½¬3è‚¡" â†’ (2.103, 0.2, 0.3)
    cash_match = re.search(r'(\d+)è‚¡æ´¾([\d.]+)å…ƒ', plan_str)
    bonus_match = re.search(r'é€([\d.]+)è‚¡', plan_str)
    transfer_match = re.search(r'è½¬([\d.]+)è‚¡', plan_str)
    return cash_per_share, bonus_ratio, transfer_ratio
```

### 3. adjfactorå˜åŒ–æ—¥æœŸéªŒè¯
**é—®é¢˜**: éªŒè¯æ˜¾ç¤º"adjfactoråœ¨éåˆ†çº¢æ—¥å‘ç”Ÿå˜åŒ–"
**åŸå› **: `diff()`å‡½æ•°å°†å˜åŒ–å½’å±åˆ°é™¤æƒæ—¥(åä¸€ä¸ªæ—¥æœŸ),è€Œéå‰ä¸€äº¤æ˜“æ—¥
**ç†è§£**: 
- è®¡ç®—é€»è¾‘åœ¨å‰ä¸€äº¤æ˜“æ—¥è®¾ç½®æ›´é«˜çš„adjfactorå€¼
- æ—¶é—´åºåˆ—ä¸Š,adjfactoråœ¨é™¤æƒæ—¥ä»é«˜å€¼"é™åˆ°"ä½å€¼
- `diff()`æ£€æµ‹åˆ°è¿™ä¸ª"é™",å°†å…¶å½’å±åˆ°é™¤æƒæ—¥
**è§£å†³**: ä¿®æ­£éªŒè¯é€»è¾‘,æœŸæœ›adjfactorå˜åŒ–åœ¨é™¤æƒæ—¥å½“å¤©

## ğŸ“ˆ æ•°æ®éªŒè¯

### éªŒè¯æŠ¥å‘Šæ‘˜è¦
```
æ€»è®¡: 20 åªè‚¡ç¥¨
é€šè¿‡: 20 åª (100.0%)
å¤±è´¥: 0 åª (0.0%)
```

### ç¤ºä¾‹æ•°æ®(è´µå·èŒ…å° 600519.SH)
```
adjfactorèŒƒå›´: 1.000000 ~ 1.075397
åˆ†çº¢æ¬¡æ•°: 25æ¬¡
æœ€æ–°æ—¥æœŸadjfactor: 1.000000 âœ…
```

### adjfactoråˆ†å¸ƒç»Ÿè®¡
```
æœ€å°max_adjfactor: 1.0101 (300059.SZ é¡ºç»œç”µå­)
æœ€å¤§max_adjfactor: 1.2153 (601166.SH å…´ä¸šé“¶è¡Œ)
å¹³å‡åˆ†çº¢æ¬¡æ•°: 19.85æ¬¡/è‚¡
```

## ğŸ’¾ å¤‡ä»½ä¸å®‰å…¨

### å¤‡ä»½ä¿¡æ¯
- **å¤‡ä»½ä½ç½®**: `~/.qlib/qlib_data/cn_data_backup/`
- **å¤‡ä»½æ–‡ä»¶æ•°**: 20ä¸ªCSVæ–‡ä»¶
- **åŸå§‹æ•°æ®**: å·²å®Œæ•´å¤‡ä»½
- **å›æ»šå‘½ä»¤**: `python scripts/add_adjfactor_to_all.py --rollback`

### æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
âœ… æ‰€æœ‰æ–‡ä»¶åŒ…å«adjfactoråˆ—
âœ… æ— ç¼ºå¤±å€¼
âœ… æœ€æ–°æ—¥æœŸadjfactor=1.0
âœ… adjfactorèŒƒå›´åˆç†(1.0~1.22)

## ğŸ“ ç”Ÿæˆæ–‡ä»¶

### æ•°æ®æ–‡ä»¶
```
data/dividend_history.csv              # 397æ¡åˆ†çº¢è®°å½•
data/with_adjfactor/*.csv              # 20ä¸ªå¸¦adjfactorçš„CSV
~/.qlib/qlib_data/cn_data/*.csv        # 20ä¸ªæ›´æ–°åçš„Qlibæ–‡ä»¶
~/.qlib/qlib_data/cn_data_backup/*.csv # 20ä¸ªå¤‡ä»½æ–‡ä»¶
```

### æŠ¥å‘Šæ–‡ä»¶
```
results/adjfactor_verification_report.csv     # éªŒè¯æŠ¥å‘Š
results/adjfactor_implementation_summary.md   # æœ¬æ–‡ä»¶
docs/adjfactor_workflow_guide.md             # è¯¦ç»†ä½¿ç”¨æŒ‡å—
```

## ğŸ¯ åç»­æ­¥éª¤

### 1. æµ‹è¯•å›æµ‹ç³»ç»Ÿ
```bash
python scripts/phase6d_backtest.py --year 2023
```

### 2. éªŒè¯adjfactoræ•ˆæœ
- [ ] å¯¹æ¯”å¤æƒå‰åæ”¶ç›Šç‡æ›²çº¿
- [ ] æ£€æŸ¥åˆ†çº¢æ—¥å‰åä»·æ ¼è¿ç»­æ€§
- [ ] éªŒè¯å¤šä¸ªåˆ†çº¢äº‹ä»¶çš„ç´¯ç§¯æ•ˆæœ

### 3. å®šæœŸç»´æŠ¤
- **é¢‘ç‡**: æ¯å­£åº¦æ›´æ–°ä¸€æ¬¡
- **æ­¥éª¤**:
  1. è¿è¡Œ fetch_dividend_adata.py è·å–æœ€æ–°åˆ†çº¢
  2. è¿è¡Œ calculate_adjfactor.py é‡æ–°è®¡ç®—
  3. è¿è¡Œ verify_calculated_adjfactor.py éªŒè¯
  4. è¿è¡Œ add_adjfactor_to_all.py æ›´æ–°Qlibæ•°æ®

## ğŸ“š å‚è€ƒæ–‡æ¡£

- **è¯¦ç»†æŒ‡å—**: `docs/adjfactor_workflow_guide.md`
- **éªŒè¯æŠ¥å‘Š**: `results/adjfactor_verification_report.csv`
- **è„šæœ¬ä½ç½®**: `scripts/fetch_dividend_adata.py` ç­‰4ä¸ªæ–‡ä»¶

## âœ… è´¨é‡ä¿è¯

### ä»£ç è´¨é‡
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
- âœ… æ•°æ®éªŒè¯æœºåˆ¶
- âœ… è‡ªåŠ¨å¤‡ä»½åŠŸèƒ½

### æµ‹è¯•è¦†ç›–
- âœ… å•è‚¡ç¥¨æµ‹è¯•é€šè¿‡
- âœ… æ‰¹é‡å¤„ç†æµ‹è¯•é€šè¿‡
- âœ… éªŒè¯æµç¨‹æµ‹è¯•é€šè¿‡
- âœ… å›æ»šåŠŸèƒ½æµ‹è¯•é€šè¿‡

### æ–‡æ¡£å®Œæ•´æ€§
- âœ… ä½¿ç”¨æŒ‡å—å®Œæ•´
- âœ… æ•…éšœæ’é™¤æ–‡æ¡£
- âœ… æŠ€æœ¯ç»†èŠ‚è¯´æ˜
- âœ… ç»´æŠ¤æµç¨‹æ–‡æ¡£

---

**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
**ç‰ˆæœ¬**: 1.0
**å®Œæˆæ—¥æœŸ**: 2025-10-16
**æ‰§è¡Œè€…**: Claude Code
