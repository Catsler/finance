# Phase 1: 2005-2024 数据质量验证报告

执行时间: 2025-10-02
验证目标: 测试20年回测(2005-2024)所需数据的可用性和完整性
预期交易日数: ~4500天 (20年 × ~245天/年，扣除节假日)

---

## 1. 沪深300指数数据测试

/Users/elie/Library/Python/3.9/lib/python/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(
2025-10-02 12:22:02,142 [INFO] ============================================================
2025-10-02 12:22:02,143 [INFO] Stock 数据转换工具 - Phase 0
2025-10-02 12:22:02,143 [INFO] ============================================================
2025-10-02 12:22:02,143 [INFO] 正在获取 sh000300 数据（20050101 ~ 20241231）...
2025-10-02 12:22:03,334 [WARNING] 第 1 次尝试失败，1 秒后重试: AKShare 未返回数据：sh000300
2025-10-02 12:22:04,339 [INFO] 正在获取 sh000300 数据（20050101 ~ 20241231）...
2025-10-02 12:22:05,592 [WARNING] 第 2 次尝试失败，2 秒后重试: AKShare 未返回数据：sh000300
2025-10-02 12:22:07,595 [INFO] 正在获取 sh000300 数据（20050101 ~ 20241231）...
2025-10-02 12:22:15,440 [ERROR] 所有重试失败: AKShare 未返回数据：sh000300
2025-10-02 12:22:15,441 [ERROR] ============================================================
2025-10-02 12:22:15,441 [ERROR] ❌ Validation Failed: AKShare 未返回数据：sh000300
2025-10-02 12:22:15,441 [ERROR] ============================================================

结果: ❌ 失败 - AKShare未返回sh000300数据
尝试原因分析: symbol格式或时间跨度问题

---

## 2. 老股票数据测试

### 测试 600519.SH (贵州茅台)
2025-10-02 12:23:52,534 [INFO] ============================================================
2025-10-02 12:23:52,534 [INFO] Stock 数据转换工具 - Phase 0
2025-10-02 12:23:52,534 [INFO] ============================================================
2025-10-02 12:23:52,534 [INFO] 正在获取 600519.SH 数据（20050101 ~ 20241231）...
2025-10-02 12:23:54,144 [INFO] 成功获取 4790 条记录
2025-10-02 12:23:54,145 [INFO] 600519.SH | 记录数=4790 | 缺失率=0.00% | 价格范围=[58.52, 13457.95] | 总成交量=156922530
2025-10-02 12:23:54,145 [INFO] ✓ 600519.SH 数据验证通过
2025-10-02 12:23:54,158 [INFO] 数据已保存: /Users/elie/.qlib/qlib_data/cn_data/600519.SH.csv (276.13 KB)
2025-10-02 12:23:54,158 [INFO] ============================================================
2025-10-02 12:23:54,158 [INFO] ✅ Validation Passed: 600519.SH → /Users/elie/.qlib/qlib_data/cn_data/600519.SH.csv
2025-10-02 12:23:54,158 [INFO] ============================================================

结果: ✅ 成功 - 4790条记录，缺失率0.00%


### 测试 000001.SZ
2025-10-02 12:26:38,807 [INFO] 成功获取 4710 条记录
2025-10-02 12:26:38,810 [INFO] 000001.SZ | 记录数=4710 | 缺失率=0.00% | 价格范围=[130.30, 3256.73] | 总成交量=3460888912
2025-10-02 12:26:38,826 [INFO] ✅ Validation Passed: 000001.SZ → /Users/elie/.qlib/qlib_data/cn_data/000001.SZ.csv
结果: ✅ 成功 - 4710条记录，缺失率0.00%

### 测试 000858.SZ
2025-10-02 12:28:43,096 [INFO] 成功获取 4733 条记录
2025-10-02 12:28:43,098 [INFO] 000858.SZ | 记录数=4733 | 缺失率=0.00% | 价格范围=[57.30, 5538.97] | 总成交量=1261341868
2025-10-02 12:28:43,114 [INFO] ✅ Validation Passed: 000858.SZ → /Users/elie/.qlib/qlib_data/cn_data/000858.SZ.csv
结果: ✅ 成功 - 4733条记录，缺失率0.00%

### 测试 600036.SH
2025-10-02 12:28:58,838 [INFO] 成功获取 4789 条记录
2025-10-02 12:28:58,839 [INFO] 600036.SH | 记录数=4789 | 缺失率=0.00% | 价格范围=[9.82, 249.49] | 总成交量=3440586601
2025-10-02 12:28:58,850 [INFO] ✅ Validation Passed: 600036.SH → /Users/elie/.qlib/qlib_data/cn_data/600036.SH.csv
结果: ✅ 成功 - 4789条记录，缺失率0.00%

### 测试 000002.SZ
2025-10-02 12:30:09,410 [INFO] 成功获取 4658 条记录
2025-10-02 12:30:09,412 [INFO] 000002.SZ | 记录数=4658 | 缺失率=0.00% | 价格范围=[142.54, 5786.67] | 总成交量=4492729752
2025-10-02 12:30:09,426 [INFO] ✅ Validation Passed: 000002.SZ → /Users/elie/.qlib/qlib_data/cn_data/000002.SZ.csv
结果: ✅ 成功 - 4658条记录，缺失率0.00%

### 测试 600276.SH
2025-10-02 12:30:34,987 [INFO] 成功获取 4819 条记录
2025-10-02 12:30:34,993 [INFO] 600276.SH | 记录数=4819 | 缺失率=0.00% | 价格范围=[22.53, 4538.88] | 总成交量=671606943
2025-10-02 12:30:35,028 [INFO] ✅ Validation Passed: 600276.SH → /Users/elie/.qlib/qlib_data/cn_data/600276.SH.csv
结果: ✅ 成功 - 4819条记录，缺失率0.00%

### 测试 600900.SH
2025-10-02 12:38:45,399 [INFO] 成功获取 4435 条记录
2025-10-02 12:38:45,401 [INFO] 600900.SH | 记录数=4435 | 缺失率=0.00% | 价格范围=[7.48, 71.70] | 总成交量=1722183869
2025-10-02 12:38:45,414 [INFO] ✅ Validation Passed: 600900.SH → /Users/elie/.qlib/qlib_data/cn_data/600900.SH.csv
结果: ✅ 成功 - 4435条记录，缺失率0.00%

---

## 3. 汇总统计

### 股票数据测试结果

| 股票代码 | 交易日数 | 缺失率 | 状态 |
|---------|---------|--------|------|
| 600519.SH | 4790 | 0.00% | ✅ |
| 000001.SZ | 4710 | 0.00% | ✅ |
| 000858.SZ | 4733 | 0.00% | ✅ |
| 600036.SH | 4789 | 0.00% | ✅ |
| 000002.SZ | 4658 | 0.00% | ✅ |
| 600276.SH | 4819 | 0.00% | ✅ |
| 600900.SH | 4435 | 0.00% | ✅ |

**成功股票数**: 7/7 (100%)
**平均交易日数**: 4705天
**平均缺失率**: 0.00%
**预期交易日数**: ~4900天 (20年 × 245天/年)
**实际覆盖率**: 96.0% (4705/4900)

### 场景判断

✅ **Scenario A: 优质数据，可继续Phase 2**
- 满足条件：>=7只股票可用，缺失率<5%
- 7只老股票全部可用，缺失率均为0%
- 数据质量极高，可支持20年回测

### 指数数据问题

❌ **HS300指数数据获取失败**
- AKShare使用symbol "sh000300" 无法获取2005-2024数据
- 可能原因：
  1. 沪深300指数于2005年4月8日发布，2005年初无数据
  2. AKShare接口对指数历史数据有限制
  3. 需要使用不同的数据源或API

**解决方案**：
1. 尝试调整起始日期为2005-04-08（指数发布日）
2. 或使用现有2022-2025基准数据，扩展到2005-2024
3. 或考虑使用其他基准（如上证指数）


---

## 4. 尝试修正HS300指数数据获取

### 尝试1: 调整起始日期为2005-04-08（指数发布日）

2025-10-02 15:31:08,208 [ERROR] 所有重试失败: AKShare 未返回数据：sh000300
2025-10-02 15:31:08,209 [ERROR] ============================================================
2025-10-02 15:31:08,209 [ERROR] ❌ Validation Failed: AKShare 未返回数据：sh000300
2025-10-02 15:31:08,209 [ERROR] ============================================================
/Users/elie/Library/Python/3.9/lib/python/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(
测试获取沪深300完整历史数据...
成功获取 5762 条记录
时间范围: 2002-01-04 ~ 2025-09-30

前5行:
         date      open      high       low     close  volume
0  2002-01-04  1316.455  1316.455  1316.455  1316.455       0
1  2002-01-07  1302.084  1302.084  1302.084  1302.084       0
2  2002-01-08  1292.714  1292.714  1292.714  1292.714       0
3  2002-01-09  1272.645  1272.645  1272.645  1272.645       0
4  2002-01-10  1281.261  1281.261  1281.261  1281.261       0

后5行:
            date      open      high       low     close       volume
5757  2025-09-24  4495.266  4567.495  4494.113  4566.071  22048260800
5758  2025-09-25  4563.983  4613.949  4558.842  4593.488  22982333300
5759  2025-09-26  4576.914  4597.847  4550.049  4550.049  20848211400
5760  2025-09-29  4555.034  4647.569  4541.425  4620.053  27435887700
5761  2025-09-30  4629.899  4647.503  4616.224  4640.694  24798035900

2005-2024范围: 4858 条记录
时间范围: 2005-01-04 00:00:00 ~ 2024-12-31 00:00:00

### 尝试2: 使用正确的API - ak.stock_zh_index_daily()

✅ **成功获取沪深300完整历史数据！**
- 总记录数: 5762条 (2002-2025)
- 2005-2024范围: 4858条记录
- 缺失率: 0.8% (4858/4900 = 99.2%)

**问题根源**：
- akshare-to-qlib-converter.py使用 `ak.stock_zh_a_hist()` 专门用于A股
- 指数数据需要使用 `ak.stock_zh_index_daily(symbol="sh000300")`
- utils/io.py中的load_benchmark_data()已正确使用此API

---

## 5. 最终结论

### ✅ Scenario A: 优质数据，可继续Phase 2

**数据可用性总结**：

| 数据类型 | 可用性 | 交易日数 | 缺失率 | 状态 |
|---------|--------|---------|--------|------|
| 沪深300指数 | ✅ | 4858 | 0.8% | 优质 |
| 600519.SH | ✅ | 4790 | 0.00% | 优质 |
| 000001.SZ | ✅ | 4710 | 0.00% | 优质 |
| 000858.SZ | ✅ | 4733 | 0.00% | 优质 |
| 600036.SH | ✅ | 4789 | 0.00% | 优质 |
| 000002.SZ | ✅ | 4658 | 0.00% | 优质 |
| 600276.SH | ✅ | 4819 | 0.00% | 优质 |
| 600900.SH | ✅ | 4435 | 0.00% | 优质 |

**综合评估**：
- ✅ 成功股票: 7/7 (100%)
- ✅ 基准指数: 可用（4858天，覆盖率99.2%）
- ✅ 平均缺失率: <1%
- ✅ 数据质量: 优质

**建议**：
✅ **继续Phase 2: 脚本适配20年回测**

**Phase 2 工作内容**：
1. 修改 `utils/io.py` 的 `load_benchmark_data()` 函数，支持2005-2024范围
2. 修改 `scripts/phase6d_backtest.py` 的年份配置，添加2005-2024年配置
3. 测试单个年份（如2010）验证逻辑正确性
4. 执行完整20年回测
5. 分析牛市（2006-2007, 2014-2015, 2019-2020）vs熊市表现

---

**验证完成时间**: 2025-10-02 15:35
**状态**: ✅ Scenario A - 数据质量优质，可继续Phase 2

