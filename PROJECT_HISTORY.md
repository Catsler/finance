# Stock量化交易系统 - 项目历史

本文档记录了项目从Phase 0到Phase 8的完整演进历史。

---

## Phase 0: 数据源验证（2025-10-01）

**目标**: 验证免费数据源（AKShare）并完成基础工具准备

**执行时间**: 15分钟

**核心成果**:
- ✅ 验证成功率: 75% (3/4股票)
- ✅ AKShare数据质量确认（缺失率仅3.17%）
- ✅ 基础环境配置完成（Python 3.9.6 + AKShare 1.17.61）
- ✅ 数据转换脚本开发（akshare-to-qlib-converter.py）

**交付物**: 9个文件（文档、脚本、配置）

**关键发现**: 沪深300指数需特殊API，其他个股数据质量良好

---

## Phase 1: 环境搭建

**目标**: 完成Qlib安装和项目基础架构

**核心成果**:
- ✅ Qlib环境配置成功
- ✅ 项目目录结构确立
- ✅ 配置文件体系建立（config.yaml）
- ✅ 基础工具函数库创建（utils/）

---

## Phase 2: 策略回测

**目标**: 实现动量策略并完成历史回测

**核心策略**:
- 选股标准: 20日涨幅 > 0%
- 持仓数量: 10只股票
- 调仓周期: 月度
- 风控机制: 止损-5%、止盈-10%（浮动）

**回测结果** (2022-2024):
- 2022年: +2.72%（vs 沪深300超额+23.99%）✅
- 2023年: -18.16%（vs 沪深300超额-6.41%）⚠️
- 2024年: +47.05%（vs 沪深300超额+28.41%）✅

**交付物**: momentum_backtest.py、strategy_optimization.py

---

## Phase 3: 参数优化

**目标**: 优化动量阈值和持仓数量

**实验设计**:
- 动量阈值范围: -10% ~ +10%（步长5%）
- 持仓数量: 5、10、20只
- 样本池: 10只 → 96只扩展验证

**核心发现**:
- 动量阈值0%表现最稳定
- 10只持仓在2023年失效（-18.16%）
- 96只样本池验证策略普适性

**交付物**: strategy_optimization.py、phase3_completion_summary.md

---

## Phase 4: 风控优化

**目标**: 引入动态止损止盈机制

**风控机制**:
- 基础止损: -5%
- 基础止盈: -10%（退出时机优化）
- 动态调整: 根据市场波动率

**结果**: 风控机制降低最大回撤，但对整体收益影响有限

**交付物**: risk_control_backtest.py

---

## Phase 5: 策略整合

**目标**: 整合Phase 2-4成果，建立统一回测框架

**整合内容**:
- 统一配置管理（config.yaml）
- 模块化代码结构（utils/io.py）
- 标准化输出格式（JSON + CSV）

**交付物**: 统一回测框架

---

## Phase 6A-6D: 动态选股探索

**Phase 6A**: PoC验证 - 动态选股可行性
**Phase 6B**: 多条件筛选（MA5/MA10/MA20）
**Phase 6C**: 稳定性过滤器（连续上涨天数）
**Phase 6D**: 月度动态调仓基线

**Phase 6D核心成果** (2022-2024):
- 2022年: +2.72%（vs 300超额+23.99%）
- 2023年: -18.16%（vs 300超额-6.41%）❌
- 2024年: +47.05%（vs 300超额+28.41%）
- **问题识别**: 10只持仓2023年失效

**交付物**: phase6d_backtest.py（核心回测引擎）

---

## Phase 6E: 股票池扩展验证（2025-10-02）

**目标**: 验证2023年失效是否为样本不足导致

**执行时间**: 6分钟

**核心发现** (10只 → 20只):

| 年份 | 10只收益 | 20只收益 | 改善幅度 | 评价 |
|------|---------|---------|---------|------|
| 2022 | +2.72% | +2.48% | -0.24% | 持平 |
| **2023** | **-18.16%** | **+6.10%** | **+24.26%** | **根本性修复** ✅ |
| 2024 | +47.05% | +40.17% | -6.88% | 仍优秀 |

**超额收益**(vs 沪深300):
- 2023年: -6.41% → **+17.85%**（改善+24.26%）

**代价**:
- 换手率提升: 21.67% → 65.83%（3.0倍）

**结论**: **20只股票池成为新标准配置（medium_cap）**

---

## Phase 6F: 换手率降低尝试（失败）

**目标**: 在保持收益的前提下降低换手率

**实验方案**:
- 方案A（季度调仓）: 2023年-13.62%（vs 月度恶化13.59%）❌
- 方案B（stability过滤）: 功能正常但震荡市无效 ❌

**核心发现**:
- 动量策略高换手是本质特性，难以简单优化
- 2023年市场波动导致老仓位持续失效
- **Phase 6E配置（20股+月调）已是最佳可达方案**

**风险标注**:
- 佣金≥0.1%时2023年收益趋零
- 实盘需极低成本券商（综合<0.1%）
- 适合趋势市，震荡市需谨慎

**交付物**: PHASE6F_SUMMARY.md、实验结果文档

---

## Phase 7: 2025年实盘追踪

**目标**: 跟踪2025年策略表现，积累实盘经验

**核心工作**:
- T+0交易策略开发（KDJ指标）
- 实时行情接入（Sina财经API）
- 模拟盘管理系统（Streamlit UI）
- 大盘股票池扩展（100只）

**技术突破**:
- 60分钟K线KDJ策略
- 纸上交易系统（SQLite + 前后端分离）
- 实时价格对齐验证（Phase 7E）

**交付物**: 
- kdj_strategy/（KDJ策略模块）
- paper_trading/（模拟盘后端）
- pages/3_📡_实时行情.py（Streamlit UI）

---

## Phase 8: 20年历史数据回测（2005-2024）

**目标**: 长周期验证策略有效性和风险特征

### Phase 8子阶段:

**Phase 8A**: 2007年暴涨行情分析
- 发现: 牛市中策略显著跑赢指数

**Phase 8B**: 2019年市场分析
- 发现: 震荡市策略表现稳定

**Phase 8C**: 2021年行情回顾
- 发现: 结构性行情中选股效果明显

**Phase 8D**: 数据质量审计
- 复权因子验证完成
- 数据缺失率<5%
- 建立质量监控体系

**核心成果**:
- ✅ 20年数据收集完成（2005-2024）
- ✅ 复权因子计算和验证（Phase 9.1）
- ✅ 数据质量审计体系建立
- ✅ 长周期回测框架完善

**交付物**: 
- phase8_20year_backtest.py（规划中）
- data_quality_audit.py
- adjfactor验证脚本系列

---

## Phase 9: 数据质量增强

**Phase 9.1**: 复权因子验证
- ✅ AKShare复权数据对比验证
- ✅ 自计算复权因子验证
- ✅ 大盘股100只复权验证完成
- ✅ 建立adjfactor质量监控

**Phase 9A**: AI辅助增强（TradingAgents探针）
- ✅ GPT-5-mini API接入测试
- ✅ 智能选股信心评分PoC
- ⚠️ API稳定性问题待解决

**交付物**:
- docs/ADJFACTOR_GUIDE.md（复权完整指南）
- scripts/verify_*.py（验证脚本系列，已归档）
- results/phase9_20stocks_qfq_comparison.md

---

## 附录: 详细技术报告

### Phase 2完整报告
详见: `results/phase2_completion_report.md`（已整合到本文档，原文件已删除）

### Phase 8数据质量报告
详见: `results/data_quality_summary.md`

### Phase 6E最终配置
详见: `stock_pool.yaml`（medium_cap: 20只股票池）

### Phase 9.1复权验证报告
详见: 
- `results/adjfactor_verification_report.csv`
- `docs/ADJFACTOR_GUIDE.md`

---

## 项目演进时间线

```
2025-10-01  Phase 0: 数据源验证（15分钟）
2025-10-01  Phase 1: 环境搭建
2025-10-01  Phase 2: 策略回测（首次完整回测）
2025-10-02  Phase 3: 参数优化
2025-10-02  Phase 4: 风控优化
2025-10-02  Phase 5: 策略整合
2025-10-02  Phase 6A-6D: 动态选股探索
2025-10-02  Phase 6E: 股票池扩展（6分钟，关键突破）
2025-10-02  Phase 6F: 换手率优化尝试（失败但有价值）
2025-10-15  Phase 7: 2025实盘追踪启动
2025-12-16  Phase 8: 20年回测数据准备
2025-12-18  Phase 9: 数据质量增强
2025-12-19  Phase 10: 代码库清理（本次）
```

---

## 当前最佳配置（Phase 6E验证）

**选股策略**:
- 动量标准: 20日涨幅 > 0%
- MA确认: MA5 > MA10（上升趋势）
- 持仓数量: **20只**（medium_cap）
- 调仓周期: **月度**
- 风控机制: 浮动止损-5%、止盈-10%

**历史表现** (2022-2024):
- 2022年: +2.48%（vs 300超额+23.75%）
- 2023年: +6.10%（vs 300超额+17.85%）
- 2024年: +40.17%（vs 300超额+21.52%）
- **平均超额**: **+19.90%/年**

**成本要求**:
- 综合费率需 < 0.1%（佣金+印花税+滑点）
- 换手率: 年均60-75%

**适用场景**:
- ✅ 熊市/震荡市超额显著（2022-2023）
- ✅ 牛市/反弹市保持优势（2024）
- ⚠️ 需要极低成本券商支持

---

## 技术栈演进

**数据源**: AKShare（免费） → Qlib格式转换
**回测引擎**: 自研（phase6d_backtest.py）
**可视化**: Streamlit（app.py + pages/）
**数据库**: SQLite（模拟盘）
**实时行情**: Sina财经API
**AI增强**: GPT-5-mini探针（实验中）

**语言**: Python 3.8-3.10
**依赖管理**: requirements.txt
**版本控制**: Git（详细的CLAUDE.md指导）

---

**最后更新**: 2025-12-19（Phase 10代码库清理完成）
**文档维护**: 随项目演进持续更新
